# 📄 장바구니 Promotion 정책 기반 최종 가격 계산 기능 기획안

---

## 1. 프로젝트 개요

### 1.1 목적
- 사용자가 장바구니에 담은 상품에 대해 **복수의 프로모션 정책**을 자동 적용하여 **최종 결제 금액**을 산출.
- **정확한 할인 적용**을 통해 고객 만족도를 높이고, **복잡한 할인 조건**을 기계적으로 처리하여 CS/운영 리스크 최소화.

### 1.2 기대 효과
- 다양한 마케팅 정책을 시스템적으로 반영 → 기획/마케팅팀의 캠페인 운영 유연성 확보.
- 할인 우선순위 및 중복 규칙을 명확히 정의 → 불필요한 CS 발생 방지.
- 정책 엔진 기반 확장 → 향후 신규 프로모션 추가/변경 시 개발 최소화.

---

## 2. 기능 정의

### 2.1 입력 요소
- **장바구니 상품 정보**
  - 상품ID, 가격, 수량, 옵션, 카테고리, 브랜드
- **사용자 속성**
  - 회원 등급(VIP, 일반), 신규/기존 고객 여부
- **외부 조건**
  - 결제 수단, 결제 시점(주말/이벤트 기간 등)
- **프로모션 정책 세트**
  - 쿠폰, 적립금 사용, 이벤트 조건

### 2.2 출력 요소
- 적용된 프로모션 내역 (쿠폰, 할인, 증정, 배송비 등)
- 총 할인 금액
- 최종 결제 금액
- 사용자에게 노출되는 "적용된 할인 상세 내역"

---

## 3. 프로모션 정책 유형

| 구분 | 설명 | 예시 |
|------|------|------|
| 상품 단위 | 특정 상품/브랜드/옵션에 직접 적용 | 상품 A 10% 할인, 브랜드B 2+1 |
| 카테고리 단위 | 특정 카테고리 구매액/수량 기반 | 뷰티 ≥ 50,000원 → 5,000원 할인 |
| 장바구니 단위 | 전체 금액/상품수 기준 | 100,000원 이상 → 무료배송 |
| 결제 수단/시기 | 특정 카드, 페이, 요일, 이벤트 | X카드 10% 할인, 주말 5% 할인 |
| 쿠폰/적립금 | 사용자 보유 쿠폰, 적립금 | 카테고리 쿠폰 20%, 적립금 최대 30% |

---

## 4. 할인 적용 규칙

1. **우선순위 규칙**
   - 신규 고객 전용, 이벤트 한정 > 세트/쿠폰 > 장바구니 할인 > 상품 개별 할인 > 배송비/적립금
2. **중복 불가 규칙**
   - 쿠폰은 1개만 사용 가능
   - 신규 고객 할인은 다른 모든 할인과 중복 불가
   - 세트 할인은 카테고리 할인과 중복 불가
3. **적용 순서**
   - (1) 강제적 정책(신규, 이벤트)  
   - (2) 카테고리/세트/쿠폰  
   - (3) 장바구니 단위  
   - (4) 상품 단위 할인  
   - (5) 배송비/적립금

---

## 5. Use Case Matrix (요약본)

| 조건 | 할인 유형 | 중복 가능 여부 | 우선순위 |
|------|-----------|----------------|----------|
| 신규 고객 첫 결제 | 15,000원 할인 | 불가 | 최상 |
| 이벤트 기간 | 1+1 행사 | 불가 | 최상 |
| 카테고리: 뷰티 ≥ 50,000원 | 5,000원 할인 | 가능 | 중 |
| 식품 2개 + 생활용품 1개 | 20% 세트 할인 | 불가 | 상 |
| 장바구니 ≥ 150,000원 | 10% 할인 | 불가 | 상 |
| VIP 회원 | 5% 추가 할인 | 가능 | 중 |
| X카드 결제 | 10% 할인 | 가능 | 중 |
| 주말 결제 | 5% 할인 | 가능 | 하 |
| 적립금 사용 | 최대 30% | 가능 | 하 |

---

## 6. 사용자 시나리오 예시

### 시나리오 1: 신규 고객 + 장바구니 120,000원
- 조건: 신규 고객 (첫 결제), 장바구니 ≥ 100,000원
- 적용: 신규 고객 15,000원 할인 (다른 할인 무효화), 무료 배송 미적용
- 최종 결과: **105,000원 결제**

### 시나리오 2: VIP 회원 + X카드 + 카테고리 조건 충족
- 조건: 뷰티 70,000원 / 식품 50,000원, 장바구니 120,000원, VIP 회원, X카드
- 적용: 뷰티 할인(5,000원) + VIP 5% 할인 + X카드 10% 할인 + 무료 배송
- 최종 결과: **약 99,750원**

### 시나리오 3: 이벤트 기간 + 쿠폰 보유
- 조건: 블랙프라이데이 이벤트, 장바구니 쿠폰 5,000원
- 적용: 이벤트 1+1 행사 우선, 쿠폰 사용 불가
- 최종 결과: **행사 적용 후 금액 산출**

---

## 7. 화면/UX 요구사항

- **장바구니 화면**
  - "적용 가능한 프로모션" 자동 표시
  - "할인 상세 내역" 영역 제공
  - 중복 불가 정책 시 안내 문구 제공
- **결제 화면**
  - 선택 가능한 쿠폰 목록 표시
  - 적립금 사용 가능 금액 표시
  - 최종 결제 금액 실시간 반영

---

## 8. 기술 요구사항

- **Promotion Engine**
  - 정책 Rule 기반 (JSON/DSL 정의 가능)
  - 우선순위, 중복 불가 처리 로직 내장
- **확장성**
  - 신규 프로모션 등록 시 코드 수정 최소화
  - 테스트 모드/시뮬레이션 기능 제공
- **성능**
  - 100개 상품 장바구니도 500ms 이내 계산

---

## 9. 운영/관리

- 관리자 콘솔에서 프로모션 등록/수정
- 로그/리포트 시스템: 프로모션별 사용률, 매출 기여도 측정
- A/B 테스트 기능 지원 (예: VIP 할인 5% vs 7%)